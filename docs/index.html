<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Informe Diario - Dirección General de Crédito Público</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial,sans-serif;margin:24px;color:#111}
    h1{font-size:28px;margin:0 0 18px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid #eee;text-align:left}
    th{background:#fafafa}
    a{color:#0a58ca;text-decoration:none}
    a:hover{text-decoration:underline}
    .muted{color:#666;font-size:12px;margin-top:12px}
    .size{white-space:nowrap}
  </style>
</head>
<body>
  <h1>Informe Diario - Dirección General de Crédito Público</h1>

  <table id="tbl">
    <thead>
      <tr>
        <th style="width:220px">Fecha</th>
        <th>Archivo</th>
        <th class="size" style="width:110px">Tamaño</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="3" class="muted">Cargando…</td></tr>
    </tbody>
  </table>

  <p class="muted" id="stamp"></p>

  <script>
    // === Config ===
    const FOLDER = 'informes'; // dentro de /docs
    const USER   = 'ramirojorge1990-sys';
    const REPO   = 'coparticipacion';

    // Zona horaria de Santa Fe (UTC-3)
    const AR_TZ = 'America/Argentina/Cordoba';

    // Base del sitio (incluye /<usuario>.github.io/<repo>/)
    const basePath = (function () {
      const p = window.location.pathname.replace(/index\.html$/,'');
      return p.replace(/\/+$/,'') + '/' + FOLDER + '/';
    })();

    // ---- Utilidades de formato ----
    const fmtSize = bytes => {
      if (bytes == null) return '';
      const kb = bytes / 1024;
      return (Math.round(kb * 10) / 10).toLocaleString('es-AR') + ' KB';
    };

    const fmtDateTime = iso => {
      const d = new Date(iso);
      return d.toLocaleString('es-AR', {
        timeZone: AR_TZ,
        hour12: false,
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit'
      });
    };

    // ---- Render ----
    function render(rows) {
      const tb = document.getElementById('tbody');
      tb.innerHTML = '';
      if (!rows.length) {
        tb.innerHTML = '<tr><td colspan="3" class="muted">No hay archivos todavía.</td></tr>';
        return;
      }
      rows.forEach(f => {
        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = fmtDateTime(f.lastmod || f.date || f.time || f.mtime || f.updated || f.created || f.ts);
        tr.appendChild(tdDate);

        const tdName = document.createElement('td');
        const href = basePath + encodeURIComponent(f.name); // soporta tildes/espacios
        const a = document.createElement('a');
        a.href = href; a.target = '_blank'; a.rel = 'noopener';
        a.textContent = f.name;
        tdName.appendChild(a);
        tr.appendChild(tdName);

        const tdSize = document.createElement('td');
        tdSize.className = 'size';
        tdSize.textContent = fmtSize(f.size);
        tr.appendChild(tdSize);

        tb.appendChild(tr);
      });

      // Sello de tiempo en hora de Santa Fe
      document.getElementById('stamp').textContent =
        'Última actualización: ' + new Date().toLocaleString('es-AR' {
          timeZone: AR_TZ,
          hour12: false,
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        });
    }

    // ---- Carga desde la API pública de GitHub ----
    async function load() {
      try {
        const url = `https://api.github.com/repos/${USER}/${REPO}/contents/docs/${FOLDER}`;
        const resp = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' } });
        if (!resp.ok) throw new Error('No se pudo leer el listado (' + resp.status + ')');
        const data = await resp.json();

        // Nota: para simplicidad usamos el "ahora" como fecha visible.
        // Si querés la fecha real de commit de cada archivo, decime y
        // te paso la versión que consulta la commits API.
        const nowISO = new Date().toISOString();
        const rows = (data || [])
          .filter(x => x.type === 'file' && /\.pdf$/i.test(x.name))
          .map(x => ({ name: x.name, size: x.size, lastmod: nowISO }))
          .sort((a, b) => a.name < b.name ? 1 : -1); // suponiendo fecha en el nombre

        render(rows);
      } catch (e) {
        console.error(e);
        document.getElementById('tbody').innerHTML =
          '<tr><td colspan="3" class="muted">Error al cargar el listado.</td></tr>';
      }
    }

    load();
  </script>
</body>
</html>
