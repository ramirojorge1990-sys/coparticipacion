<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Informe Diario - Dirección General de Crédito Público</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --fg:#111; --muted:#6b7280; --line:#f2f2f2; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif; 
         max-width:1200px; margin:24px auto; padding:0 16px; color:var(--fg);}
    h1{font-weight:700; font-size:clamp(20px,3vw,28px); margin:0 0 8px;}
    .muted{color:var(--muted); font-size:13px; margin-top:14px}
    table{width:100%; border-collapse:collapse; margin-top:16px;}
    th,td{padding:12px 10px; text-align:left; border-bottom:1px solid var(--line);}
    thead th{background:#fafafa; font-weight:600;}
    a{color:#2563eb; text-decoration:none}
    a:hover{text-decoration:underline}
    @media (max-width:720px){
      th:nth-child(3), td:nth-child(3){display:none} /* ocultar Tamaño en móviles */
    }
  </style>
</head>
<body>
  <h1>Informe Diario - Dirección General de Crédito Público</h1>

  <table id="tbl">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Archivo</th>
        <th>Tamaño</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td class="muted">Cargando…</td><td></td><td></td></tr>
    </tbody>
  </table>

  <div class="muted" id="updated"></div>

  <script>
    // === CONFIGURACIÓN ===
    const owner  = "ramirojorge1990-sys";
    const repo   = "coparticipacion";
    const branch = "main";
    const folder = "docs/informes"; // carpeta que publica Pages: /coparticipacion/informes/

    const fmtAR = new Intl.DateTimeFormat("es-AR", {
      timeZone: "America/Argentina/Buenos_Aires",
      dateStyle: "short", timeStyle: "short"
    });

    // Lista los PDFs desde el contenido del repo y obtiene la fecha del último commit de cada uno
    async function load() {
      const tbody = document.getElementById("tbody");
      try {
        const listURL = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}?ref=${branch}`;
        const res = await fetch(listURL);
        const items = await res.json();
        let pdfs = (Array.isArray(items) ? items : []).filter(it => it.name.toLowerCase().endsWith(".pdf"));

        // Ordená por nombre descendente (o cambiá por fecha si querés)
        pdfs.sort((a,b) => b.name.localeCompare(a.name, 'es', { numeric:true }));

        // Trae fecha de último commit por archivo (equivale a “subido/actualizado”)
        const rows = [];
        for (const it of pdfs) {
          const commitsURL = `https://api.github.com/repos/${owner}/${repo}/commits?sha=${branch}&path=${encodeURIComponent(folder + "/" + it.name)}&per_page=1`;
          let fechaTxt = "—";
          try {
            const r = await fetch(commitsURL);
            const commits = await r.json();
            const iso = commits?.[0]?.commit?.author?.date || commits?.[0]?.commit?.committer?.date;
            if (iso) fechaTxt = fmtAR.format(new Date(iso));
          } catch(e) { /* ignora fallo de fecha */ }

          const sizeKB = (it.size/1024).toFixed(1) + " KB";
          const href = encodeURIComponent(it.name); // relativo a /informes/

          rows.push(`<tr>
              <td>${fechaTxt}</td>
              <td><a href="./${href}">${it.name}</a></td>
              <td>${sizeKB}</td>
            </tr>`);
        }

        tbody.innerHTML = rows.join("") || `<tr><td class="muted">No hay archivos</td><td></td><td></td></tr>`;
        document.getElementById("updated").textContent = 
          "Última actualización: " + fmtAR.format(new Date());
      } catch (err) {
        tbody.innerHTML = `<tr><td class="muted">Error al cargar</td><td></td><td></td></tr>`;
        console.error(err);
      }
    }
    load();
  </script>
</body>
</html>
